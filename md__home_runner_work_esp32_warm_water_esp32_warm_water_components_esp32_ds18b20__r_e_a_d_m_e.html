<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>esp32-warm-water: esp32-ds18b20</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">esp32-warm-water
   </div>
   <div id="projectbrief">esp32 based project for the control of a heating element based on temperature</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">esp32-ds18b20 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Docs: <a href="https://wolffshots.github.io/esp32-ds18b20/index.html"><img src="https://api.travis-ci.com/wolffshots/esp32-ds18b20.svg?branch=main" alt="couldn't get build status" style="pointer-events: none;" title="Current doc build status" class="inline"/></a></p>
<h1><a class="anchor" id="autotoc_md14"></a>
Introduction</h1>
<p>This is a ESP32-compatible C component for the Maxim Integrated DS18B20 Programmable Resolution 1-Wire Digital Thermometer device.</p>
<p>It supports multiple devices on the same 1-Wire bus.</p>
<p>It is written and tested for v2.1, v3.0-3.3 and v4.1-beta1 of the <a href="https://github.com/espressif/esp-idf">ESP-IDF</a> environment, using the xtensa-esp32-elf toolchain (gcc version 5.2.0).</p>
<h1><a class="anchor" id="autotoc_md15"></a>
Dependencies</h1>
<p>Requires <a href="https://github.com/wolffshots/esp32-owb">esp32-owb</a>.</p>
<h1><a class="anchor" id="autotoc_md16"></a>
Example</h1>
<p>See <a href="https://github.com/DavidAntliff/esp32-ds18b20-example">esp32-ds18b20-example</a> for an example that supports single and multiple devices on a single bus.</p>
<p>This fork has been extended to implement some of the functionality of the example above.</p>
<h1><a class="anchor" id="autotoc_md17"></a>
Folder contents</h1>
<p>the component <b>esp32-ds18b20</b> contains two source file in C language <a href="ds18b20.c">ds18b20.c</a> and <a href="ds18b20_wrapper.c">ds18b20_wrapper.c</a>. these files are located in the root folder.</p>
<p>esp-idf projects are build using cmake. the project build configuration is contained in <code>CMakeLists.txt</code> files that provide set of directives and instructions describing the project's source files and targets (executable, library, or both).</p>
<p>below is short explanation of remaining files in the project folder.</p>
<div class="fragment"><div class="line">├── doc                         </div>
<div class="line">├── include                     header file directory</div>
<div class="line">│   ├── ds18b20_wrapper.h       the header file for the wrapper component</div>
<div class="line">│   └── ds18b20.h               the header file for the component</div>
<div class="line">├── .gitignore                  describes what files and folders git should ignore</div>
<div class="line">├── .travis.yml                 build rules for creating docs via doxygen</div>
<div class="line">├── CMakeLists.txt              base project cmake file (describes dependencies, include dir and src dir)</div>
<div class="line">├── component.mk                component make file</div>
<div class="line">├── ds18b20_wrapper.c           core src file of the wrapper component</div>
<div class="line">├── ds18b20.c                   core src file of the component</div>
<div class="line">├── Kconfig.projbuild           kconfig description file to add build time vars</div>
<div class="line">├── LICENSE.md                  MIT license file</div>
<div class="line">└── README.md                   this file</div>
</div><!-- fragment --><p>for more information on structure and contents of esp-idf projects, please refer to Section <a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-guides/build-system.html">Build System</a> of the esp-idf programming guide.</p>
<h1><a class="anchor" id="autotoc_md18"></a>
Features</h1>
<p>In cooperation with the underlying esp32-owb component, this component includes:</p>
<ul>
<li>External power supply mode.</li>
<li>Parasitic power mode (VDD and GND connected) - see notes below.</li>
<li>Static (stack-based) or dynamic (malloc-based) memory model.</li>
<li>No globals - support any number of DS18B20 devices on any number of 1-Wire buses simultaneously.</li>
<li>1-Wire device detection and validation, including search for multiple devices on a single bus.</li>
<li>Addressing optimisation for a single (solo) device on a bus.</li>
<li>CRC checks on temperature data.</li>
<li>Programmable temperature measurement resolution (9, 10, 11 or 12-bit resolution).</li>
<li>Temperature conversion and retrieval.</li>
<li>Separation of conversion and temperature retrieval to allow for simultaneous conversion across multiple devices.</li>
</ul>
<h1><a class="anchor" id="autotoc_md19"></a>
Parasitic Power Mode</h1>
<p>Consult the <a href="http://datasheets.maximintegrated.com/en/ds/DS18B20.pdf">datasheet</a> for more detailed information about Parasitic Power mode.</p>
<p>Parasitic power operation can be detected by <code><a class="el" href="ds18b20_8c.html#ad144c72353070a8b49a2f53ff118f18c" title="Check OneWire bus for presence of parasitic-powered devices.">ds18b20_check_for_parasite_power()</a></code> followed by a call to <code><a class="el" href="owb_8h.html#a323323f435cc78e3c83b6cdf432d952e" title="Enable or disable use of parasitic power on the One Wire Bus. This affects how devices signal on the ...">owb_use_parasitic_power()</a></code>, or simply set explicitly by a call to the latter.</p>
<p>This library has been tested on the ESP32 with two parasitic-power configurations, with two DS18B20 devices at 3.3V:</p>
<ol type="1">
<li>Disconnect power to each device's VDD pin, and connect that pin to GND for each device. Power is supplied to each device through the OWB data line.</li>
<li>Connect the OWB data line to VCC via a P-channel MOSFET (e.g. BS250) and current-limiting resistor (e.g. 270 Ohm). Ensure your code calls <code><a class="el" href="owb_8h.html#ac31df44fc1b7de48de8c72717684727f" title="Enable or disable use of extra GPIO to activate strong pull-up circuit. This only has effect if paras...">owb_use_strong_pullup_gpio()</a></code> with the GPIO connected to the MOSFET Gate. The GPIO will go high during temperature conversion, turning on the MOSFET and providing power from VCC to each device through the OWB data line.</li>
</ol>
<p>If you set up configuration 1 and do not see CRC errors, but you get incorrect temperature readings around 80 - 85 degrees C, then it is likely that your DS18B20 devices are running out of power during the temperature conversion. In this case, consider reducing the value of the pull-up resistor. For example, I have had success obtaining correct conversions from two parasitic DS18B20 devices by replacing the 4k7 Ohm pull-up resistor with a 1 kOhm resistor.</p>
<p>Alternatively, consider using configuration 2.</p>
<p>Note that use of parasitic power mode disables the ability for devices on the bus to signal that an operation has completed. This means that DS18B20 devices in parasitic power mode are not able to communicate when they have completed a temperature conversion. In this mode, a delay for a pre-calculated duration occurs, and then the conversion result is read from the device(s). <em>If your ESP32 is not running on the correct clock rate, this duration may be too short!</em> <br  />
</p>
<h1><a class="anchor" id="autotoc_md20"></a>
Documentation</h1>
<p>Automatically generated API documentation (doxygen) is available <a href="https://wolffshots.github.io/esp32-ds18b20/index.html">here</a>.</p>
<h1><a class="anchor" id="autotoc_md21"></a>
License</h1>
<p>The code in this project is licensed under the MIT license - see LICENSE for details.</p>
<h1><a class="anchor" id="autotoc_md22"></a>
Links</h1>
<ul>
<li><a href="http://datasheets.maximintegrated.com/en/ds/DS18B20.pdf">DS18B20 Datasheet</a></li>
<li><a href="https://www.maximintegrated.com/en/app-notes/index.mvp/id/126">1-Wire Communication Through Software</a></li>
<li><a href="https://www.maximintegrated.com/en/app-notes/index.mvp/id/187">1-Wire Search Algorithm</a></li>
<li><a href="https://github.com/espressif/esp-idf">Espressif IoT Development Framework for ESP32</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md23"></a>
Acknowledgements</h1>
<p>Parts of this code are based on references provided to the public domain by Maxim Integrated.</p>
<p>"1-Wire" is a registered trademark of Maxim Integrated. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
